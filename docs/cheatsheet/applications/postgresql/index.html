<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="postgresql"><meta property="og:title" content="postgresql"><meta property="og:description" content="show where a user has permissions SELECT a.schemaname, a.tablename, b.usename, HAS_TABLE_PRIVILEGE(b.usename, a.schemaname || '.' || a.tablename, 'select') as select, HAS_TABLE_PRIVILEGE(b.usename, a.schemaname || '.' || a.tablename, 'insert') as insert, HAS_TABLE_PRIVILEGE(b.usename, a.schemaname || '.' || a.tablename, 'update') as update, HAS_TABLE_PRIVILEGE(b.usename, a.schemaname || '.' || a.tablename, 'delete') as delete, HAS_TABLE_PRIVILEGE(b.usename, a.schemaname || '.' || a.tablename, 'references') as references FROM pg_tables a, pg_user b WHERE a.schemaname = 'example_schema'; show objects ownership SELECT nsp.nspname as object_schema, cls."><meta property="og:type" content="article"><meta property="og:url" content="https://hellupline.dev/docs/cheatsheet/applications/postgresql/"><meta property="article:modified_time" content="2020-02-19T16:55:56-03:00"><title>postgresql | HellUpLine Stuffs</title><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.68d45956421753cdf6bcfc865ede445c56afc5bcaaebfe02961f44fe77d8f45a.css integrity="sha256-aNRZVkIXU832vPyGXt5EXFavxbyq6/4Clh9E/nfY9Fo="><script defer src=/en.search.min.76f481f9ed85145d8fb9da0550a510ded6b71709f0cde36cdf6faa707ff427aa.js integrity="sha256-dvSB+e2FFF2PudoFUKUQ3ta3FwnwzeNs32+qcH/0J6o="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-147048049-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=https://hellupline.dev/><span>HellUpLine Stuffs</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><p><strong>hellupline-stuffs</strong></p><ul><li><a href=/gallery/>gallery</a></li><li><a href=/todo/>todo</a></li><li><a href=/posts/><strong>posts</strong></a></li></ul></li><li><p><strong>cheatsheet</strong></p><ul><li><a href=/docs/cheatsheet/applications/><strong>applications</strong></a><ul><li><a href=/docs/cheatsheet/applications/postgresql/ class=active>postgresql</a></li><li><a href=/docs/cheatsheet/applications/mysql/>mysql</a></li><li><a href=/docs/cheatsheet/applications/nginx/>nginx</a></li><li><a href=/docs/cheatsheet/applications/kubernetes/>kubernetes</a></li><li><a href=/docs/cheatsheet/applications/docker/>docker</a></li></ul></li><li><a href=/docs/cheatsheet/commands/><strong>commands</strong></a><ul><li><a href=/docs/cheatsheet/commands/network/>network</a></li><li><a href=/docs/cheatsheet/commands/curl/>curl</a></li><li><a href=/docs/cheatsheet/commands/ssh/>ssh</a></li><li><a href=/docs/cheatsheet/commands/gpg/>gpg</a></li><li><a href=/docs/cheatsheet/commands/linux/>linux</a></li><li><a href=/docs/cheatsheet/commands/osx/>osx</a></li><li><a href=/docs/cheatsheet/commands/aws/>aws</a></li><li><a href=/docs/cheatsheet/commands/utils/>utils</a></li></ul></li></ul></li><li><p><strong>scripts</strong></p><ul><li><a href=/docs/scripts/kubernetes/><strong>kubernetes</strong></a></li><li><a href=/docs/scripts/toys/><strong>toys</strong></a></li><li><a href=/docs/scripts/utils/><strong>utils</strong></a></li><li><a href=/docs/scripts/golang/><strong>golang</strong></a></li></ul></li><li><p><strong>cloud</strong></p><ul><li><a href=/docs/cloud/kubernetes/><strong>kubernetes</strong></a></li><li><a href=/docs/cloud/nginx/><strong>nginx</strong></a></li></ul></li><li><p><a href=/docs/archlinux/install/><strong>archlinux</strong></a></p></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class="flex align-center justify-between book-header"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>postgresql</strong></header><article class=markdown><h2 id=show-where-a-user-has-permissions>show where a user has permissions</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#00a8c8>SELECT</span>
    <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>schemaname</span><span style=color:#111>,</span>
    <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>tablename</span><span style=color:#111>,</span>
    <span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>usename</span><span style=color:#111>,</span>
    <span style=color:#111>HAS_TABLE_PRIVILEGE</span><span style=color:#111>(</span><span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>usename</span><span style=color:#111>,</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>schemaname</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>.</span><span style=color:#d88200>&#39;</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>tablename</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>select</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#00a8c8>select</span><span style=color:#111>,</span>
    <span style=color:#111>HAS_TABLE_PRIVILEGE</span><span style=color:#111>(</span><span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>usename</span><span style=color:#111>,</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>schemaname</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>.</span><span style=color:#d88200>&#39;</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>tablename</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>insert</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#00a8c8>insert</span><span style=color:#111>,</span>
    <span style=color:#111>HAS_TABLE_PRIVILEGE</span><span style=color:#111>(</span><span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>usename</span><span style=color:#111>,</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>schemaname</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>.</span><span style=color:#d88200>&#39;</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>tablename</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>update</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#00a8c8>update</span><span style=color:#111>,</span>
    <span style=color:#111>HAS_TABLE_PRIVILEGE</span><span style=color:#111>(</span><span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>usename</span><span style=color:#111>,</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>schemaname</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>.</span><span style=color:#d88200>&#39;</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>tablename</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>delete</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#00a8c8>delete</span><span style=color:#111>,</span>
    <span style=color:#111>HAS_TABLE_PRIVILEGE</span><span style=color:#111>(</span><span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>usename</span><span style=color:#111>,</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>schemaname</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>.</span><span style=color:#d88200>&#39;</span> <span style=color:#f92672>|</span><span style=color:#f92672>|</span> <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>tablename</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>references</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#00a8c8>references</span>
<span style=color:#00a8c8>FROM</span>
    <span style=color:#111>pg_tables</span> <span style=color:#111>a</span><span style=color:#111>,</span>
    <span style=color:#111>pg_user</span> <span style=color:#111>b</span>
<span style=color:#00a8c8>WHERE</span>
    <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>schemaname</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>example_schema</span><span style=color:#d88200>&#39;</span><span style=color:#111>;</span>
</code></pre></div><h2 id=show-objects-ownership>show objects ownership</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#00a8c8>SELECT</span>
    <span style=color:#111>nsp</span><span style=color:#111>.</span><span style=color:#111>nspname</span> <span style=color:#00a8c8>as</span> <span style=color:#111>object_schema</span><span style=color:#111>,</span>
    <span style=color:#111>cls</span><span style=color:#111>.</span><span style=color:#111>relname</span> <span style=color:#00a8c8>as</span> <span style=color:#111>object_name</span><span style=color:#111>,</span>
    <span style=color:#111>rol</span><span style=color:#111>.</span><span style=color:#111>rolname</span> <span style=color:#00a8c8>as</span> <span style=color:#00a8c8>owner</span><span style=color:#111>,</span>
    <span style=color:#00a8c8>case</span> <span style=color:#111>cls</span><span style=color:#111>.</span><span style=color:#111>relkind</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>r</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>TABLE</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>m</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>MATERIALIZED_VIEW</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>i</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>INDEX</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>S</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>SEQUENCE</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>v</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>VIEW</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>c</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>TYPE</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>else</span> <span style=color:#111>cls</span><span style=color:#111>.</span><span style=color:#111>relkind</span><span style=color:#111>:</span><span style=color:#111>:</span><span style=color:#111>text</span>
    <span style=color:#00a8c8>end</span> <span style=color:#00a8c8>as</span> <span style=color:#111>object_type</span>
<span style=color:#00a8c8>FROM</span>
    <span style=color:#111>pg_class</span> <span style=color:#111>cls</span>
<span style=color:#00a8c8>JOIN</span>
    <span style=color:#111>pg_roles</span> <span style=color:#111>rol</span> <span style=color:#00a8c8>ON</span> <span style=color:#111>rol</span><span style=color:#111>.</span><span style=color:#111>oid</span> <span style=color:#f92672>=</span> <span style=color:#111>cls</span><span style=color:#111>.</span><span style=color:#111>relowner</span>
<span style=color:#00a8c8>JOIN</span>
    <span style=color:#111>pg_namespace</span> <span style=color:#111>nsp</span> <span style=color:#00a8c8>ON</span> <span style=color:#111>nsp</span><span style=color:#111>.</span><span style=color:#111>oid</span> <span style=color:#f92672>=</span> <span style=color:#111>cls</span><span style=color:#111>.</span><span style=color:#111>relnamespace</span>
<span style=color:#00a8c8>WHERE</span>
    <span style=color:#111>nsp</span><span style=color:#111>.</span><span style=color:#111>nspname</span> <span style=color:#00a8c8>NOT</span> <span style=color:#00a8c8>IN</span> <span style=color:#111>(</span><span style=color:#d88200>&#39;</span><span style=color:#d88200>information_schema</span><span style=color:#d88200>&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>pg_catalog</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>AND</span> <span style=color:#111>nsp</span><span style=color:#111>.</span><span style=color:#111>nspname</span> <span style=color:#f92672>!</span><span style=color:#f92672>=</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>pg_toast</span><span style=color:#d88200>&#39;</span>
    <span style=color:#00a8c8>AND</span> <span style=color:#111>rol</span><span style=color:#111>.</span><span style=color:#111>rolname</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>current_user</span> <span style=color:#75715e>-- remove this if you want to see all objects
</span><span style=color:#75715e></span><span style=color:#00a8c8>ORDER</span> <span style=color:#00a8c8>BY</span>
    <span style=color:#111>nsp</span><span style=color:#111>.</span><span style=color:#111>nspname</span><span style=color:#111>,</span>
    <span style=color:#111>cls</span><span style=color:#111>.</span><span style=color:#111>relname</span><span style=color:#111>;</span>
</code></pre></div><h2 id=create-a-read-only-access>create a read-only access</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>-- example schema
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span><span style=color:#111>;</span>

<span style=color:#75715e>-- example tables
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>TABLE</span> <span style=color:#111>example_schema</span><span style=color:#111>.</span><span style=color:#111>example_table</span> <span style=color:#111>(</span><span style=color:#00a8c8>key</span> <span style=color:#111>TEXT</span> <span style=color:#00a8c8>PRIMARY</span> <span style=color:#00a8c8>KEY</span><span style=color:#111>,</span> <span style=color:#111>value</span> <span style=color:#111>TEXT</span><span style=color:#111>)</span><span style=color:#111>;</span>
<span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>TABLE</span> <span style=color:#111>example_schema</span><span style=color:#111>.</span><span style=color:#111>example_another_table</span> <span style=color:#111>(</span><span style=color:#00a8c8>key</span> <span style=color:#111>TEXT</span> <span style=color:#00a8c8>PRIMARY</span> <span style=color:#00a8c8>KEY</span><span style=color:#111>,</span> <span style=color:#111>value</span> <span style=color:#111>TEXT</span><span style=color:#111>)</span><span style=color:#111>;</span>

<span style=color:#75715e>-- application role
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>ROLE</span> <span style=color:#111>example_app_ro</span> <span style=color:#111>NOSUPERUSER</span> <span style=color:#00a8c8>NOCREATEDB</span> <span style=color:#111>NOCREATEROLE</span> <span style=color:#111>NOREPLICATION</span> <span style=color:#111>INHERIT</span><span style=color:#111>;</span>
<span style=color:#00a8c8>ALTER</span> <span style=color:#00a8c8>DEFAULT</span> <span style=color:#00a8c8>PRIVILEGES</span> <span style=color:#00a8c8>IN</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span> <span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>SELECT</span> <span style=color:#00a8c8>ON</span> <span style=color:#111>TABLES</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_app_ro</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>USAGE</span> <span style=color:#00a8c8>ON</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_app_ro</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>SELECT</span> <span style=color:#00a8c8>ON</span> <span style=color:#00a8c8>ALL</span> <span style=color:#111>TABLES</span> <span style=color:#00a8c8>IN</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_app_ro</span><span style=color:#111>;</span>

<span style=color:#75715e>-- example table read-only role
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>ROLE</span> <span style=color:#111>example_table_role_ro</span> <span style=color:#111>NOSUPERUSER</span> <span style=color:#00a8c8>NOCREATEDB</span> <span style=color:#111>NOCREATEROLE</span> <span style=color:#111>NOREPLICATION</span> <span style=color:#111>INHERIT</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>USAGE</span> <span style=color:#00a8c8>ON</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_table_role_ro</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>SELECT</span> <span style=color:#00a8c8>ON</span> <span style=color:#111>example_schema</span><span style=color:#111>.</span><span style=color:#111>example_table</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_table_role_ro</span><span style=color:#111>;</span>

<span style=color:#75715e>-- example another table read-only role
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>ROLE</span> <span style=color:#111>example_another_table_role_ro</span> <span style=color:#111>NOSUPERUSER</span> <span style=color:#00a8c8>NOCREATEDB</span> <span style=color:#111>NOCREATEROLE</span> <span style=color:#111>NOREPLICATION</span> <span style=color:#111>INHERIT</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>USAGE</span> <span style=color:#00a8c8>ON</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_another_table_role_ro</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>SELECT</span> <span style=color:#00a8c8>ON</span> <span style=color:#111>example_schema</span><span style=color:#111>.</span><span style=color:#111>example_another_table</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_table_role_ro</span><span style=color:#111>;</span>

<span style=color:#75715e>-- group role, granted example_table_role_ro and example_another_table_role_ro
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>ROLE</span> <span style=color:#111>example_group_ro</span> <span style=color:#111>NOSUPERUSER</span> <span style=color:#00a8c8>NOCREATEDB</span> <span style=color:#111>NOCREATEROLE</span> <span style=color:#111>NOREPLICATION</span> <span style=color:#111>INHERIT</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#111>example_table_role_ro</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_group_ro</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#111>example_another_table_role_ro</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_group_ro</span><span style=color:#111>;</span>

<span style=color:#75715e>-- user role, granted example_group_ro
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>ROLE</span> <span style=color:#111>example_user</span> <span style=color:#00a8c8>WITH</span> <span style=color:#111>NOSUPERUSER</span> <span style=color:#00a8c8>NOCREATEDB</span> <span style=color:#111>NOCREATEROLE</span> <span style=color:#111>NOREPLICATION</span> <span style=color:#111>INHERIT</span> <span style=color:#111>LOGIN</span> <span style=color:#111>PASSWORD</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>mysecretpassword</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>VALID</span> <span style=color:#00a8c8>UNTIL</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>infinity</span><span style=color:#d88200>&#39;</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#111>example_group_ro</span> <span style=color:#00a8c8>TO</span> <span style=color:#111>example_user</span><span style=color:#111>;</span>
</code></pre></div><h3 id=in-redshit>in redshit</h3><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>GROUP</span> <span style=color:#d88200>&#34;</span><span style=color:#d88200>example_group_ro</span><span style=color:#d88200>&#34;</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>USAGE</span> <span style=color:#00a8c8>ON</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span> <span style=color:#00a8c8>TO</span> <span style=color:#00a8c8>GROUP</span> <span style=color:#111>example_group_ro</span><span style=color:#111>;</span>
<span style=color:#00a8c8>GRANT</span> <span style=color:#00a8c8>SELECT</span> <span style=color:#00a8c8>ON</span> <span style=color:#00a8c8>ALL</span> <span style=color:#111>TABLES</span> <span style=color:#00a8c8>IN</span> <span style=color:#00a8c8>SCHEMA</span> <span style=color:#111>example_schema</span> <span style=color:#00a8c8>TO</span> <span style=color:#00a8c8>GROUP</span> <span style=color:#111>example_group_ro</span><span style=color:#111>;</span>
</code></pre></div><h2 id=inspect-default-schema-privileges>inspect default schema privileges</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#00a8c8>SELECT</span>
    <span style=color:#111>nsp</span><span style=color:#111>.</span><span style=color:#111>nspname</span><span style=color:#111>,</span>
    <span style=color:#00a8c8>case</span> <span style=color:#111>defacl</span><span style=color:#111>.</span><span style=color:#111>defaclobjtype</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>r</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>TABLE</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>m</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>MATERIALIZED_VIEW</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>i</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>INDEX</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>S</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>SEQUENCE</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>v</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>VIEW</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>when</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>c</span><span style=color:#d88200>&#39;</span> <span style=color:#00a8c8>then</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>TYPE</span><span style=color:#d88200>&#39;</span>
        <span style=color:#00a8c8>else</span> <span style=color:#111>defacl</span><span style=color:#111>.</span><span style=color:#111>defaclobjtype</span><span style=color:#111>:</span><span style=color:#111>:</span><span style=color:#111>text</span>
    <span style=color:#00a8c8>end</span> <span style=color:#00a8c8>as</span> <span style=color:#111>object_type</span><span style=color:#111>,</span>
    <span style=color:#111>defacl</span><span style=color:#111>.</span><span style=color:#111>defaclacl</span>
<span style=color:#00a8c8>FROM</span>
    <span style=color:#111>pg_default_acl</span> <span style=color:#111>defacl</span>
<span style=color:#00a8c8>JOIN</span>
    <span style=color:#111>pg_namespace</span> <span style=color:#111>nsp</span> <span style=color:#00a8c8>ON</span> <span style=color:#111>defacl</span><span style=color:#111>.</span><span style=color:#111>defaclnamespace</span><span style=color:#f92672>=</span><span style=color:#111>nsp</span><span style=color:#111>.</span><span style=color:#111>oid</span><span style=color:#111>;</span>
</code></pre></div><h2 id=get-user-roles>get user roles</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql> <span style=color:#00a8c8>SELECT</span>
    <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>rolname</span><span style=color:#111>,</span>
    <span style=color:#111>ARRAY_AGG</span><span style=color:#111>(</span><span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>rolname</span><span style=color:#111>)</span>
<span style=color:#00a8c8>FROM</span>
    <span style=color:#111>pg_roles</span> <span style=color:#111>a</span><span style=color:#111>,</span>
    <span style=color:#111>pg_roles</span> <span style=color:#111>b</span>
<span style=color:#00a8c8>WHERE</span>
    <span style=color:#111>pg_has_role</span><span style=color:#111>(</span><span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>rolname</span><span style=color:#111>,</span> <span style=color:#111>b</span><span style=color:#111>.</span><span style=color:#111>oid</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>member</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span>
<span style=color:#00a8c8>GROUP</span> <span style=color:#00a8c8>BY</span>
    <span style=color:#111>a</span><span style=color:#111>.</span><span style=color:#111>rolname</span><span style=color:#111>;</span>
</code></pre></div><h2 id=redshift>redshift</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>-- Create a new user
</span><span style=color:#75715e></span><span style=color:#00a8c8>CREATE</span> <span style=color:#00a8c8>USER</span> <span style=color:#111>example_user</span> <span style=color:#00a8c8>WITH</span> <span style=color:#111>PASSWORD</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>mysecretpassword</span><span style=color:#d88200>&#39;</span><span style=color:#111>;</span>

<span style=color:#75715e>-- Add users to an existing group
</span><span style=color:#75715e></span><span style=color:#00a8c8>ALTER</span> <span style=color:#00a8c8>GROUP</span> <span style=color:#111>example_group</span> <span style=color:#00a8c8>ADD</span> <span style=color:#00a8c8>USER</span> <span style=color:#111>example_user</span><span style=color:#111>;</span>

<span style=color:#75715e>--- Query to check all groups a user is in
</span><span style=color:#75715e></span><span style=color:#00a8c8>SELECT</span>
    <span style=color:#111>u</span><span style=color:#111>.</span><span style=color:#111>usename</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>rolname</span><span style=color:#111>,</span>
    <span style=color:#111>u</span><span style=color:#111>.</span><span style=color:#111>usesuper</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>rolsuper</span><span style=color:#111>,</span>
    <span style=color:#00a8c8>true</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>rolinherit</span><span style=color:#111>,</span>
    <span style=color:#00a8c8>false</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>rolcreaterole</span><span style=color:#111>,</span>
    <span style=color:#111>u</span><span style=color:#111>.</span><span style=color:#111>usecreatedb</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>rolcreatedb</span><span style=color:#111>,</span>
    <span style=color:#00a8c8>true</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>rolcanlogin</span><span style=color:#111>,</span>
    <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>rolconnlimit</span><span style=color:#111>,</span>
    <span style=color:#111>u</span><span style=color:#111>.</span><span style=color:#111>valuntil</span> <span style=color:#00a8c8>as</span> <span style=color:#111>rolvaliduntil</span><span style=color:#111>,</span>
    <span style=color:#111>ARRAY</span><span style=color:#111>(</span>
        <span style=color:#00a8c8>SELECT</span>
            <span style=color:#00a8c8>g</span><span style=color:#111>.</span><span style=color:#111>groname</span>
        <span style=color:#00a8c8>FROM</span>
            <span style=color:#111>pg_catalog</span><span style=color:#111>.</span><span style=color:#111>pg_group</span> <span style=color:#00a8c8>g</span>
        <span style=color:#00a8c8>WHERE</span>
            <span style=color:#111>u</span><span style=color:#111>.</span><span style=color:#111>usesysid</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>ANY</span><span style=color:#111>(</span><span style=color:#00a8c8>g</span><span style=color:#111>.</span><span style=color:#111>grolist</span><span style=color:#111>)</span>
    <span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#111>memberof</span>
<span style=color:#00a8c8>FROM</span>
    <span style=color:#111>pg_catalog</span><span style=color:#111>.</span><span style=color:#111>pg_user</span> <span style=color:#111>u</span>
<span style=color:#00a8c8>WHERE</span>
    <span style=color:#111>u</span><span style=color:#111>.</span><span style=color:#111>usename</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;</span><span style=color:#d88200>YOUR_USERNAME_HERE</span><span style=color:#d88200>&#39;</span>
<span style=color:#00a8c8>ORDER</span> <span style=color:#00a8c8>BY</span>
    <span style=color:#111>rolname</span><span style=color:#111>;</span>
</code></pre></div><h2 id=run-a-postresql-in-docker>run a postresql in docker</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run --rm -it --name my-sgdb <span style=color:#8045ff>\
</span><span style=color:#8045ff></span>    --env <span style=color:#111>POSTGRES_PASSWORD</span><span style=color:#f92672>=</span>mysecretpassword <span style=color:#8045ff>\
</span><span style=color:#8045ff></span>    --env <span style=color:#111>POSTGRES_USER</span><span style=color:#f92672>=</span>myuser <span style=color:#8045ff>\
</span><span style=color:#8045ff></span>    --env <span style=color:#111>POSTGRES_DB</span><span style=color:#f92672>=</span>mydatabase <span style=color:#8045ff>\
</span><span style=color:#8045ff></span>    --publish 5432:5432 <span style=color:#8045ff>\
</span><span style=color:#8045ff></span>    postgres
</code></pre></div><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker <span style=color:#111>exec</span> -it my-sgdb <span style=color:#8045ff>\
</span><span style=color:#8045ff></span>    psql <span style=color:#d88200>&#39;host=localhost user=myuser dbname=mydatabase&#39;</span>
</code></pre></div><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker run --rm -it postgres <span style=color:#8045ff>\
</span><span style=color:#8045ff></span>    psql <span style=color:#d88200>&#39;host=myhost user=myuser password=mysecretpassword dbname=mydatabase&#39;</span>
</code></pre></div></article><div class="book-footer justify-between"><div><a class="flex align-center" href=https://github.com/hellupline/hellupline.github.io-source/commit/3fcf3a4ab05d60a3a1876ec9f70b38c05a2fb1c4 title="Last modified by Renan Vedovato Traba | Feb 19, 2020" target=_blank><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Feb 19, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/hellupline/hellupline.github.io-source/edit/master/content/docs/cheatsheet/applications/postgresql.md target=_blank><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></div><aside class="book-toc levels-true fixed"><nav id=TableOfContents><ul><li><a href=#show-where-a-user-has-permissions>show where a user has permissions</a></li><li><a href=#show-objects-ownership>show objects ownership</a></li><li><a href=#create-a-read-only-access>create a read-only access</a><ul><li><a href=#in-redshit>in redshit</a></li></ul></li><li><a href=#inspect-default-schema-privileges>inspect default schema privileges</a></li><li><a href=#get-user-roles>get user roles</a></li><li><a href=#redshift>redshift</a></li><li><a href=#run-a-postresql-in-docker>run a postresql in docker</a></li></ul></nav></aside></main></body></html>